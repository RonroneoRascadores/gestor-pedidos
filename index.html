<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Pedidos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/jspdf@latest/dist/jspdf.umd.min.js"></script>
    <style>
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .slide-up {
            animation: slideUp 0.3s ease-out;
        }
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .copy-success {
            animation: copySuccess 0.5s ease-out;
        }
        @keyframes copySuccess {
            0% { background-color: #10b981; transform: scale(1); }
            50% { background-color: #059669; transform: scale(1.05); }
            100% { background-color: #10b981; transform: scale(1); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <div class="container mx-auto px-4 py-6 max-w-md">
        <!-- Header -->
        <div class="text-center mb-6">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">üçï Sistema de Pedidos</h1>
            <div id="connectionStatus" class="text-sm font-medium px-3 py-1 rounded-full inline-block">
                ‚öôÔ∏è Configurando...
            </div>
        </div>

        <!-- Configuration Section -->
        <div id="configSection" class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">‚öôÔ∏è Configuraci√≥n</h2>
            
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">URL del Google Apps Script:</label>
                <input type="url" id="scriptUrl" placeholder="https://script.google.com/macros/s/.../exec" 
                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm">
            </div>
            
            <div class="flex gap-2">
                <button onclick="saveConfig()" class="flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition-colors duration-200">
                    üíæ Guardar y Conectar
                </button>
                <button onclick="clearAll()" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition-colors duration-200">
                    üóëÔ∏è Limpiar Todo
                </button>
            </div>
            
            <div class="mt-4 space-y-2">
                <button onclick="syncData()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition-colors duration-200 flex items-center justify-center gap-2">
                    üîÑ Sincronizar
                </button>
                
                <button onclick="testConnection()" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-4 rounded-lg transition-colors duration-200 flex items-center justify-center gap-2">
                    üß™ Probar Conexi√≥n
                </button>
                
                <button onclick="testOrderSave()" class="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-3 px-4 rounded-lg transition-colors duration-200 flex items-center justify-center gap-2">
                    üî¨ Probar Guardado
                </button>
            </div>
        </div>

        <!-- Main App Section -->
        <div id="appSection" class="space-y-6">
            <!-- Action Buttons -->
            <div class="grid grid-cols-1 gap-3">
                <button onclick="showNewOrderForm()" class="w-full bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-bold py-4 px-6 rounded-xl shadow-lg transition-all duration-200 transform hover:scale-105">
                    ‚ûï Nuevo Pedido
                </button>
                
                <button onclick="showProductsManager()" class="w-full bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-bold py-4 px-6 rounded-xl shadow-lg transition-all duration-200 transform hover:scale-105">
                    üõ†Ô∏è Gestionar Productos
                </button>
            </div>

            <!-- Orders List -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">üìã Pedidos Recientes</h2>
                <div id="ordersList" class="space-y-3">
                    <p class="text-gray-500 text-center py-4">No hay pedidos guardados</p>
                </div>
            </div>
        </div>

        <!-- New Order Modal -->
        <div id="newOrderModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-50">
            <div class="bg-white rounded-xl shadow-2xl w-full max-w-md max-h-[90vh] overflow-y-auto">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-semibold text-gray-800">üÜï Nuevo Pedido</h2>
                        <button onclick="closeNewOrderForm()" class="text-gray-500 hover:text-gray-700 text-2xl">√ó</button>
                    </div>

                    <form id="newOrderForm" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">üë§ Nombre del Cliente:</label>
                            <input type="text" id="customerName" required 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>

                        <div>
                            <h3 class="text-lg font-medium text-gray-800 mb-3">üçï Productos:</h3>
                            <div id="productsSection" class="space-y-3">
                                <!-- Products will be loaded here -->
                            </div>
                        </div>

                        <div class="border-t pt-4">
                            <div class="flex justify-between items-center text-lg font-semibold">
                                <span>üí∞ Total:</span>
                                <span id="orderTotal">$0</span>
                            </div>
                        </div>

                        <div class="flex gap-3 pt-4">
                            <button type="button" onclick="closeNewOrderForm()" 
                                    class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition-colors duration-200">
                                Cancelar
                            </button>
                            <button type="submit" 
                                    class="flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition-colors duration-200">
                                üíæ Guardar Pedido
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Products Manager Modal -->
        <div id="productsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-50">
            <div class="bg-white rounded-xl shadow-2xl w-full max-w-md max-h-[90vh] overflow-y-auto">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-semibold text-gray-800">üõ†Ô∏è Gestionar Productos</h2>
                        <button onclick="closeProductsManager()" class="text-gray-500 hover:text-gray-700 text-2xl">√ó</button>
                    </div>

                    <!-- Add Products Section -->
                    <div class="mb-6 p-4 bg-gray-50 rounded-lg">
                        <h3 class="text-lg font-medium text-gray-800 mb-3">‚ûï Agregar Productos</h3>
                        
                        <!-- Single Product Form -->
                        <form id="addProductForm" class="space-y-3 mb-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Nombre del producto:</label>
                                <input type="text" id="newProductName" required placeholder="Ej: Pizza Napolitana"
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm">
                            </div>
                            <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition-colors duration-200">
                                ‚ûï Agregar Producto
                            </button>
                        </form>
                        
                        <!-- Bulk Import -->
                        <div class="border-t pt-4">
                            <h4 class="text-md font-medium text-gray-700 mb-2">üìã Importar Lista</h4>
                            <textarea id="bulkProductsText" placeholder="Pega tu lista aqu√≠, un producto por l√≠nea:&#10;Pizza Margarita&#10;Pizza Pepperoni&#10;Coca Cola&#10;Agua Mineral" 
                                      class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm h-24 resize-none"></textarea>
                            <button onclick="importBulkProducts()" class="w-full mt-2 bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition-colors duration-200">
                                üì• Importar Lista
                            </button>
                        </div>
                    </div>

                    <!-- Products List -->
                    <div>
                        <h3 class="text-lg font-medium text-gray-800 mb-3">üì¶ Productos Actuales</h3>
                        <div id="productsManagerList" class="space-y-2">
                            <!-- Products will be loaded here -->
                        </div>
                    </div>

                    <div class="flex gap-3 pt-4 mt-6 border-t">
                        <button onclick="closeProductsManager()" 
                                class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition-colors duration-200">
                            Cerrar
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Clear Confirmation Modal -->
        <div id="clearModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-50">
            <div class="bg-white rounded-xl shadow-2xl w-full max-w-sm">
                <div class="p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">‚ö†Ô∏è Confirmar Limpieza</h3>
                    <p class="text-gray-600 mb-4">¬øEst√°s seguro de que quieres eliminar TODOS los datos? Esta acci√≥n no se puede deshacer.</p>
                    <p class="text-sm text-red-600 mb-4">Haz clic 3 veces en "Confirmar" y luego escribe "CONFIRMAR"</p>
                    
                    <div class="mb-4">
                        <button id="confirmButton" onclick="confirmClear()" 
                                class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition-colors duration-200 mb-2">
                            Confirmar (0/3)
                        </button>
                        <input type="text" id="confirmText" placeholder="Escribe CONFIRMAR" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg text-center hidden">
                    </div>
                    
                    <div class="flex gap-3">
                        <button onclick="closeClearModal()" 
                                class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition-colors duration-200">
                            Cancelar
                        </button>
                        <button id="finalClearButton" onclick="performClear()" 
                                class="flex-1 bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition-colors duration-200 hidden">
                            üóëÔ∏è Eliminar Todo
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- NUEVO: Modal de Exportaci√≥n Optimizado para este Entorno -->
        <div id="exportModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-50">
            <div class="bg-white rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden">
                <div class="p-6 border-b bg-gradient-to-r from-blue-500 to-purple-600 text-white">
                    <div class="flex justify-between items-center">
                        <h2 class="text-xl font-semibold">üìÑ Exportar Pedido</h2>
                        <button onclick="closeExportModal()" class="text-white hover:text-gray-200 text-2xl">√ó</button>
                    </div>
                    <p class="text-sm mt-2 opacity-90">Sistema optimizado para este entorno</p>
                </div>
                
                <div class="p-6">
                    <!-- M√©todo Principal: Selecci√≥n y Copia Manual -->
                    <div class="mb-6 p-4 bg-green-50 border-2 border-green-200 rounded-lg">
                        <h3 class="text-lg font-semibold text-green-800 mb-3">‚úÖ M√âTODO GARANTIZADO</h3>
                        <div class="space-y-3">
                            <button onclick="selectAllContent()" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg transition-all duration-200 transform hover:scale-105">
                                üéØ SELECCIONAR TODO EL TEXTO
                            </button>
                            <div class="text-sm text-green-700 bg-green-100 p-3 rounded">
                                <strong>üìã Instrucciones:</strong><br>
                                1. Haz clic en "SELECCIONAR TODO EL TEXTO"<br>
                                2. Presiona <kbd class="bg-white px-2 py-1 rounded">Ctrl+C</kbd> (o <kbd class="bg-white px-2 py-1 rounded">Cmd+C</kbd> en Mac)<br>
                                3. Abre Bloc de Notas y pega con <kbd class="bg-white px-2 py-1 rounded">Ctrl+V</kbd><br>
                                4. Guarda el archivo
                            </div>
                        </div>
                    </div>

                    <!-- M√©todos Alternativos -->
                    <div class="mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                        <h3 class="text-lg font-semibold text-blue-800 mb-3">üîÑ M√âTODOS ALTERNATIVOS</h3>
                        <div class="grid grid-cols-1 gap-2">
                            <button onclick="copyToClipboardAdvanced()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition-colors duration-200">
                                üìã Copiar Autom√°ticamente
                            </button>
                            <button onclick="openInNewWindow()" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-lg transition-colors duration-200">
                                ü™ü Abrir en Nueva Ventana
                            </button>
                        </div>
                    </div>
                    
                    <!-- Contenido del Pedido -->
                    <div class="border-2 border-gray-300 rounded-lg overflow-hidden">
                        <div class="bg-gray-100 px-4 py-2 border-b">
                            <span class="font-semibold text-gray-700">üìÑ Contenido del Pedido:</span>
                            <span id="orderNumberDisplay" class="text-blue-600 font-bold ml-2"></span>
                        </div>
                        <textarea id="exportContent" readonly 
                                  class="w-full h-64 p-4 font-mono text-sm resize-none border-0 focus:ring-2 focus:ring-blue-500 bg-white" 
                                  style="font-family: 'Courier New', monospace; line-height: 1.4;"></textarea>
                    </div>
                </div>
                
                <div class="p-6 border-t bg-gray-50">
                    <button onclick="closeExportModal()" class="w-full bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-lg transition-colors duration-200">
                        ‚úÖ Cerrar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let orders = [];
        let products = {
            pizza_margarita: { name: 'Pizza Margarita', price: 0 },
            pizza_pepperoni: { name: 'Pizza Pepperoni', price: 0 },
            pizza_hawaiana: { name: 'Pizza Hawaiana', price: 0 },
            bebida_cola: { name: 'Coca Cola', price: 0 },
            bebida_agua: { name: 'Agua', price: 0 },
            postre_helado: { name: 'Helado', price: 0 }
        };
        let currentOrder = {};
        let confirmCount = 0;
        let scriptUrl = '';
        let currentExportContent = '';
        let currentExportFileName = '';

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            console.log('=== INICIALIZANDO APLICACI√ìN ===');
            loadConfig();
            loadOrders();
            loadProducts();
            updateOrdersList();
            createProductsSection();
            console.log('=== INICIALIZACI√ìN COMPLETA ===');
        });

        // SISTEMA DE EXPORTACI√ìN OPTIMIZADO PARA ESTE ENTORNO
        function exportOrderToPDF(order) {
            console.log('=== EXPORTANDO PEDIDO OPTIMIZADO ===');
            
            const content = generateOrderContent(order);
            const fileName = `Pedido_${order.orderNumber}_${order.customerName.replace(/[^a-zA-Z0-9]/g, '_')}`;
            
            // Guardar globalmente
            currentExportContent = content;
            currentExportFileName = fileName;
            
            // Mostrar modal optimizado
            showOptimizedExportModal(content, fileName, order.orderNumber);
        }

        function showOptimizedExportModal(content, fileName, orderNumber) {
            // Actualizar contenido
            document.getElementById('exportContent').value = content;
            document.getElementById('orderNumberDisplay').textContent = `#${orderNumber}`;
            
            // Mostrar modal
            document.getElementById('exportModal').classList.remove('hidden');
            document.getElementById('exportModal').classList.add('flex');
            
            showMessage('üìÑ ¬°Modal de exportaci√≥n abierto! Usa el m√©todo garantizado para obtener tu pedido', 'success');
        }

        function closeExportModal() {
            document.getElementById('exportModal').classList.add('hidden');
            document.getElementById('exportModal').classList.remove('flex');
        }

        // M√âTODO PRINCIPAL: Selecci√≥n manual (siempre funciona)
        function selectAllContent() {
            const textarea = document.getElementById('exportContent');
            
            // Enfocar y seleccionar
            textarea.focus();
            textarea.select();
            textarea.setSelectionRange(0, textarea.value.length);
            
            // Feedback visual
            textarea.style.backgroundColor = '#dbeafe';
            setTimeout(() => {
                textarea.style.backgroundColor = 'white';
            }, 1000);
            
            showMessage('‚úÖ ¬°Texto seleccionado! Ahora presiona Ctrl+C (o Cmd+C) para copiarlo', 'success');
        }

        // M√âTODO ALTERNATIVO 1: Copia autom√°tica avanzada
        function copyToClipboardAdvanced() {
            const content = currentExportContent;
            
            // M√∫ltiples m√©todos de copia
            const methods = [
                // M√©todo 1: Clipboard API moderno
                () => {
                    if (navigator.clipboard && navigator.clipboard.writeText) {
                        return navigator.clipboard.writeText(content);
                    }
                    throw new Error('Clipboard API no disponible');
                },
                
                // M√©todo 2: Selecci√≥n + execCommand
                () => {
                    const textarea = document.getElementById('exportContent');
                    textarea.select();
                    const success = document.execCommand('copy');
                    if (!success) throw new Error('execCommand fall√≥');
                    return Promise.resolve();
                },
                
                // M√©todo 3: Crear elemento temporal
                () => {
                    const tempTextarea = document.createElement('textarea');
                    tempTextarea.value = content;
                    tempTextarea.style.position = 'fixed';
                    tempTextarea.style.left = '-9999px';
                    document.body.appendChild(tempTextarea);
                    tempTextarea.select();
                    const success = document.execCommand('copy');
                    document.body.removeChild(tempTextarea);
                    if (!success) throw new Error('M√©todo temporal fall√≥');
                    return Promise.resolve();
                }
            ];
            
            // Intentar m√©todos secuencialmente
            async function tryMethods(methodIndex = 0) {
                if (methodIndex >= methods.length) {
                    showMessage('‚ùå No se pudo copiar autom√°ticamente. Usa "SELECCIONAR TODO EL TEXTO"', 'error');
                    return;
                }
                
                try {
                    await methods[methodIndex]();
                    showMessage('‚úÖ ¬°Contenido copiado al portapapeles! P√©galo en un archivo de texto', 'success');
                    
                    // Feedback visual
                    const button = event.target;
                    button.classList.add('copy-success');
                    setTimeout(() => button.classList.remove('copy-success'), 500);
                    
                } catch (error) {
                    console.log(`M√©todo ${methodIndex + 1} fall√≥:`, error.message);
                    tryMethods(methodIndex + 1);
                }
            }
            
            tryMethods();
        }

        // M√âTODO ALTERNATIVO 2: Nueva ventana
        function openInNewWindow() {
            try {
                const content = currentExportContent;
                const fileName = currentExportFileName;
                
                const newWindow = window.open('', '_blank', 'width=800,height=600,scrollbars=yes,resizable=yes');
                
                if (!newWindow) {
                    showMessage('‚ùå Bloqueador de ventanas emergentes activo. Usa "SELECCIONAR TODO EL TEXTO"', 'error');
                    return;
                }
                
                newWindow.document.write(`
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>${fileName}</title>
                        <style>
                            body { 
                                font-family: 'Courier New', monospace; 
                                padding: 20px; 
                                line-height: 1.6;
                                background: #f9fafb;
                            }
                            .container {
                                background: white;
                                padding: 30px;
                                border-radius: 10px;
                                box-shadow: 0 4px 6px rgba(0,0,0,0.1);
                                max-width: 800px;
                                margin: 0 auto;
                            }
                            .header {
                                background: #3b82f6;
                                color: white;
                                padding: 15px;
                                border-radius: 5px;
                                margin-bottom: 20px;
                                text-align: center;
                            }
                            .content {
                                white-space: pre-wrap;
                                font-size: 14px;
                                border: 1px solid #e5e7eb;
                                padding: 20px;
                                border-radius: 5px;
                                background: #f8fafc;
                            }
                            .instructions {
                                background: #fef3c7;
                                border: 1px solid #f59e0b;
                                padding: 15px;
                                border-radius: 5px;
                                margin-bottom: 20px;
                            }
                            button {
                                background: #10b981;
                                color: white;
                                border: none;
                                padding: 10px 20px;
                                border-radius: 5px;
                                cursor: pointer;
                                font-weight: bold;
                                margin: 5px;
                            }
                            button:hover { background: #059669; }
                        </style>
                    </head>
                    <body>
                        <div class="container">
                            <div class="header">
                                <h1>üìÑ ${fileName}</h1>
                                <p>Pedido exportado desde el Sistema de Pedidos</p>
                            </div>
                            
                            <div class="instructions">
                                <strong>üìã Para guardar este pedido:</strong><br>
                                1. Selecciona todo el texto de abajo (Ctrl+A)<br>
                                2. C√≥pialo (Ctrl+C)<br>
                                3. P√©galo en un archivo de texto<br>
                                4. Gu√°rdalo como "${fileName}.txt"
                            </div>
                            
                            <button onclick="selectAll()">‚úÖ Seleccionar Todo</button>
                            <button onclick="window.print()">üñ®Ô∏è Imprimir</button>
                            
                            <div class="content" id="content">${content.replace(/\n/g, '<br>')}</div>
                        </div>
                        
                        <script>
                            function selectAll() {
                                const content = document.getElementById('content');
                                const range = document.createRange();
                                range.selectNodeContents(content);
                                const selection = window.getSelection();
                                selection.removeAllRanges();
                                selection.addRange(range);
                                alert('‚úÖ Texto seleccionado! Presiona Ctrl+C para copiarlo');
                            }
                        </script>
                    <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97ba52c81391a12e',t:'MTc1NzI5MTI4MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
                    </html>
                `);
                
                newWindow.document.close();
                showMessage('ü™ü ¬°Pedido abierto en nueva ventana! Sigue las instrucciones all√≠', 'success');
                
            } catch (error) {
                console.error('Error opening new window:', error);
                showMessage('‚ùå No se pudo abrir nueva ventana. Usa "SELECCIONAR TODO EL TEXTO"', 'error');
            }
        }

        // Generar contenido del pedido
        function generateOrderContent(order) {
            const date = new Date(order.datetime);
            let content = `PEDIDO #${order.orderNumber}\n`;
            content += `================================\n\n`;
            content += `Cliente: ${order.customerName}\n`;
            content += `Fecha: ${date.toLocaleDateString('es-ES')}\n`;
            content += `Hora: ${date.toLocaleTimeString('es-ES')}\n\n`;
            content += `PRODUCTOS PEDIDOS:\n`;
            content += `------------------\n`;
            
            let hasProducts = false;
            Object.entries(order.products || {}).forEach(([key, quantity]) => {
                if (quantity > 0) {
                    const productName = order.productNames[key] || 'Producto';
                    content += `${quantity}x ${productName}\n`;
                    hasProducts = true;
                }
            });
            
            if (!hasProducts) {
                content += `(Sin productos)\n`;
            }
            
            content += `\nRESUMEN:\n`;
            content += `--------\n`;
            content += `Total de items: ${order.total}\n`;
            const status = order.status === 'completed' ? 'COMPLETADO' : 'PENDIENTE';
            content += `Estado: ${status}\n\n`;
            content += `INFORMACI√ìN ADICIONAL:\n`;
            content += `----------------------\n`;
            content += `Generado: ${new Date().toLocaleString('es-ES')}\n`;
            content += `Sistema: Sistema de Pedidos v2.0\n`;
            content += `\n--- FIN DEL PEDIDO ---`;
            
            return content;
        }

        // Products management functions
        function loadProducts() {
            const savedProducts = localStorage.getItem('products');
            if (savedProducts) {
                products = JSON.parse(savedProducts);
            }
        }

        function saveProducts() {
            localStorage.setItem('products', JSON.stringify(products));
        }

        function showProductsManager() {
            updateProductsManagerList();
            document.getElementById('productsModal').classList.remove('hidden');
            document.getElementById('productsModal').classList.add('flex');
        }

        function closeProductsManager() {
            document.getElementById('productsModal').classList.add('hidden');
            document.getElementById('productsModal').classList.remove('flex');
            // Refresh products section in new order form
            createProductsSection();
        }

        function updateProductsManagerList() {
            const container = document.getElementById('productsManagerList');
            
            if (Object.keys(products).length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-4">No hay productos</p>';
                return;
            }
            
            // Clear container first
            container.innerHTML = '';
            
            // Create elements properly with event listeners
            Object.entries(products).forEach(([key, product]) => {
                const productDiv = document.createElement('div');
                productDiv.className = 'flex items-center justify-between p-3 border border-gray-200 rounded-lg';
                
                productDiv.innerHTML = `
                    <div class="flex-1">
                        <div class="font-medium text-gray-800">${product.name}</div>
                    </div>
                    <div class="flex gap-2">
                        <button class="edit-btn bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm">
                            ‚úèÔ∏è Editar
                        </button>
                        <button class="delete-btn bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm">
                            üóëÔ∏è
                        </button>
                    </div>
                `;
                
                // Add event listeners properly
                const editBtn = productDiv.querySelector('.edit-btn');
                const deleteBtn = productDiv.querySelector('.delete-btn');
                
                editBtn.addEventListener('click', () => editProduct(key));
                deleteBtn.addEventListener('click', () => deleteProduct(key));
                
                container.appendChild(productDiv);
            });
        }

        function editProduct(key) {
            const product = products[key];
            const newName = prompt('Nuevo nombre:', product.name);
            if (newName && newName.trim()) {
                products[key].name = newName.trim();
                saveProducts();
                updateProductsManagerList();
                createProductsSection(); // Refresh the order form too
                showMessage('‚úÖ Producto actualizado correctamente', 'success');
            }
        }

        function deleteProduct(key) {
            const product = products[key];
            if (confirm(`¬øEst√°s seguro de eliminar "${product.name}"?`)) {
                delete products[key];
                saveProducts();
                updateProductsManagerList();
                createProductsSection(); // Refresh the order form too
                showMessage('üóëÔ∏è Producto eliminado correctamente', 'success');
            }
        }

        // Add product form handler
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('addProductForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const name = document.getElementById('newProductName').value.trim();
                
                if (!name) {
                    showMessage('Por favor ingresa el nombre del producto', 'error');
                    return;
                }
                
                // Generate unique key
                const key = name.toLowerCase().replace(/\s+/g, '_').replace(/[^a-z0-9_]/g, '') + '_' + Date.now();
                
                products[key] = {
                    name: name,
                    price: 0 // Default price, not used in display
                };
                
                saveProducts();
                updateProductsManagerList();
                createProductsSection(); // Refresh the order form
                
                // Clear form
                document.getElementById('newProductName').value = '';
                
                showMessage('‚úÖ Producto agregado correctamente', 'success');
            });
        });

        // Bulk import function
        function importBulkProducts() {
            const text = document.getElementById('bulkProductsText').value.trim();
            if (!text) {
                showMessage('Por favor pega la lista de productos', 'error');
                return;
            }
            
            const lines = text.split('\n').filter(line => line.trim());
            let addedCount = 0;
            
            lines.forEach(line => {
                const name = line.trim();
                if (name) {
                    // Check if product already exists
                    const existingKey = Object.keys(products).find(key => 
                        products[key].name.toLowerCase() === name.toLowerCase()
                    );
                    
                    if (!existingKey) {
                        const key = name.toLowerCase().replace(/\s+/g, '_').replace(/[^a-z0-9_]/g, '') + '_' + Date.now() + '_' + addedCount;
                        products[key] = {
                            name: name,
                            price: 0
                        };
                        addedCount++;
                    }
                }
            });
            
            if (addedCount > 0) {
                saveProducts();
                updateProductsManagerList();
                createProductsSection();
                document.getElementById('bulkProductsText').value = '';
                showMessage(`‚úÖ ${addedCount} productos agregados correctamente`, 'success');
            } else {
                showMessage('No se agregaron productos nuevos', 'info');
            }
        }

        // Configuration functions
        function loadConfig() {
            console.log('=== CARGANDO CONFIGURACI√ìN ===');
            const savedUrl = localStorage.getItem('scriptUrl');
            console.log('URL guardada:', savedUrl);
            
            if (savedUrl && savedUrl.trim()) {
                scriptUrl = savedUrl.trim();
                console.log('scriptUrl asignado:', scriptUrl);
                
                // Actualizar input
                const urlInput = document.getElementById('scriptUrl');
                if (urlInput) {
                    urlInput.value = savedUrl;
                    console.log('Input actualizado con URL');
                }
                
                // Actualizar estado inmediatamente
                console.log('Actualizando estado a conectado');
                updateConnectionStatus('connected');
            } else {
                console.log('No hay URL guardada, estado desconectado');
                scriptUrl = '';
                updateConnectionStatus('disconnected');
            }
            console.log('=== CONFIGURACI√ìN CARGADA ===');
        }

        function saveConfig() {
            const url = document.getElementById('scriptUrl').value.trim();
            if (!url) {
                showMessage('Por favor ingresa la URL del script', 'error');
                return;
            }
            
            if (!url.includes('script.google.com') || !url.endsWith('/exec')) {
                showMessage('URL inv√°lida. Debe ser de Google Apps Script y terminar en /exec', 'error');
                return;
            }
            
            scriptUrl = url;
            localStorage.setItem('scriptUrl', url);
            updateConnectionStatus('connected');
            showMessage('Configuraci√≥n guardada correctamente', 'success');
        }

        function updateConnectionStatus(status) {
            const statusElement = document.getElementById('connectionStatus');
            if (status === 'connected') {
                statusElement.textContent = '‚òÅÔ∏è Conectado';
                statusElement.className = 'text-sm font-medium px-3 py-1 rounded-full inline-block bg-green-100 text-green-800';
            } else {
                statusElement.textContent = '‚ùå Sin conexi√≥n';
                statusElement.className = 'text-sm font-medium px-3 py-1 rounded-full inline-block bg-red-100 text-red-800';
            }
        }

        // Test connection function
        async function testConnection() {
            if (!scriptUrl) {
                showMessage('Primero configura la URL del script', 'error');
                return;
            }

            showMessage('üß™ Probando conexi√≥n...', 'info');
            
            try {
                const testUrl = `${scriptUrl}?action=test&timestamp=${Date.now()}`;
                console.log('Testing URL:', testUrl);
                
                const response = await fetch(testUrl, {
                    method: 'GET',
                    mode: 'cors'
                });
                
                console.log('Response status:', response.status);
                console.log('Response headers:', response.headers);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('Response data:', data);
                
                if (data.success) {
                    showMessage('‚úÖ Conexi√≥n exitosa! El script funciona correctamente', 'success');
                    updateConnectionStatus('connected');
                } else {
                    showMessage(`‚ùå Error del script: ${data.error}`, 'error');
                }
                
            } catch (error) {
                console.error('Connection test error:', error);
                showMessage(`‚ùå Error de conexi√≥n: ${error.message}`, 'error');
                updateConnectionStatus('disconnected');
            }
        }

        // Test order save function using GET
        async function testOrderSave() {
            if (!scriptUrl) {
                showMessage('Primero configura la URL del script', 'error');
                return;
            }

            showMessage('üî¨ Probando guardado de pedido...', 'info');
            
            const testOrder = {
                orderNumber: 6666,
                customerName: 'Cliente de Prueba GET',
                datetime: new Date().toISOString(),
                products: {
                    'pizza_margarita': 2,
                    'bebida_cola': 1
                },
                productNames: {
                    'pizza_margarita': 'Pizza Margarita',
                    'bebida_cola': 'Coca Cola'
                },
                total: 27,
                status: 'pending'
            };
            
            try {
                console.log('=== ENVIANDO PEDIDO DE PRUEBA CON GET ===');
                console.log('URL:', scriptUrl);
                console.log('Pedido:', JSON.stringify(testOrder, null, 2));
                
                // Convertir el pedido a par√°metros GET
                const params = new URLSearchParams({
                    action: 'saveOrder',
                    orderNumber: testOrder.orderNumber,
                    customerName: testOrder.customerName,
                    datetime: testOrder.datetime,
                    products: JSON.stringify(testOrder.products),
                    productNames: JSON.stringify(testOrder.productNames),
                    total: testOrder.total,
                    status: testOrder.status,
                    timestamp: Date.now()
                });
                
                const testUrl = `${scriptUrl}?${params.toString()}`;
                console.log('URL completa:', testUrl);
                
                const response = await fetch(testUrl, {
                    method: 'GET',
                    mode: 'cors'
                });
                
                console.log('Response status:', response.status);
                console.log('Response ok:', response.ok);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                console.log('Response data:', JSON.stringify(result, null, 2));
                
                if (result.success) {
                    showMessage(`‚úÖ ¬°Pedido de prueba guardado exitosamente! Revisa tu Google Sheets - deber√≠a aparecer el pedido #${testOrder.orderNumber}`, 'success');
                } else {
                    showMessage(`‚ùå Error al guardar pedido de prueba: ${result.error}`, 'error');
                }
                
            } catch (error) {
                console.error('Test order save error:', error);
                showMessage(`‚ùå Error al probar guardado: ${error.message}`, 'error');
            }
        }

        // Order functions
        function loadOrders() {
            const savedOrders = localStorage.getItem('orders');
            if (savedOrders) {
                orders = JSON.parse(savedOrders);
            }
        }

        function saveOrders() {
            localStorage.setItem('orders', JSON.stringify(orders));
        }

        function showNewOrderForm() {
            currentOrder = {
                products: {},
                productNames: {}
            };
            
            // Reset form
            document.getElementById('customerName').value = '';
            resetProductQuantities();
            updateOrderTotal();
            
            document.getElementById('newOrderModal').classList.remove('hidden');
            document.getElementById('newOrderModal').classList.add('flex');
        }

        function closeNewOrderForm() {
            document.getElementById('newOrderModal').classList.add('hidden');
            document.getElementById('newOrderModal').classList.remove('flex');
        }

        function createProductsSection() {
            const section = document.getElementById('productsSection');
            section.innerHTML = '';
            
            if (Object.keys(products).length === 0) {
                section.innerHTML = '<p class="text-gray-500 text-center py-4">No hay productos disponibles. Agrega productos primero.</p>';
                return;
            }
            
            Object.entries(products).forEach(([key, product]) => {
                const productDiv = document.createElement('div');
                productDiv.className = 'flex items-center justify-between p-3 border border-gray-200 rounded-lg';
                productDiv.innerHTML = `
                    <div class="flex-1">
                        <div class="font-medium text-gray-800">${product.name}</div>
                    </div>
                    <div class="flex items-center gap-2">
                        <button type="button" onclick="updateQuantity('${key}', -1)" 
                                class="w-8 h-8 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center font-bold">-</button>
                        <span id="qty_${key}" class="w-8 text-center font-medium">0</span>
                        <button type="button" onclick="updateQuantity('${key}', 1)" 
                                class="w-8 h-8 bg-green-500 hover:bg-green-600 text-white rounded-full flex items-center justify-center font-bold">+</button>
                    </div>
                `;
                section.appendChild(productDiv);
            });
        }

        function resetProductQuantities() {
            Object.keys(products).forEach(key => {
                const qtyElement = document.getElementById(`qty_${key}`);
                if (qtyElement) {
                    qtyElement.textContent = '0';
                }
                currentOrder.products[key] = 0;
            });
        }

        function updateQuantity(productKey, change) {
            const currentQty = currentOrder.products[productKey] || 0;
            const newQty = Math.max(0, currentQty + change);
            
            currentOrder.products[productKey] = newQty;
            currentOrder.productNames[productKey] = products[productKey].name;
            
            const qtyElement = document.getElementById(`qty_${productKey}`);
            if (qtyElement) {
                qtyElement.textContent = newQty;
            }
            updateOrderTotal();
        }

        function updateOrderTotal() {
            let total = 0;
            Object.entries(currentOrder.products || {}).forEach(([key, quantity]) => {
                if (quantity > 0) {
                    total += quantity; // Just count quantities since no prices
                }
            });
            
            currentOrder.total = total;
            document.getElementById('orderTotal').textContent = `${total} items`;
        }

        // Mark order as completed
        function markOrderCompleted(orderNumber) {
            const orderIndex = orders.findIndex(order => order.orderNumber === orderNumber);
            if (orderIndex !== -1) {
                orders[orderIndex].status = 'completed';
                orders[orderIndex].completedAt = new Date().toISOString();
                
                saveOrders();
                updateOrdersList();
                
                showMessage(`‚úÖ Pedido #${orderNumber} marcado como completado`, 'success');
                
                // Tambi√©n actualizar en Google Sheets si est√° configurado
                updateOrderStatusInSheet(orders[orderIndex]);
            }
        }

        // Update order status in Google Sheets
        async function updateOrderStatusInSheet(order) {
            if (!scriptUrl) {
                return; // No hay conexi√≥n configurada
            }
            
            try {
                const params = new URLSearchParams({
                    action: 'updateOrderStatus',
                    orderNumber: order.orderNumber,
                    status: order.status,
                    completedAt: order.completedAt || '',
                    timestamp: Date.now()
                });
                
                const updateUrl = `${scriptUrl}?${params.toString()}`;
                
                const response = await fetch(updateUrl, {
                    method: 'GET',
                    mode: 'cors'
                });
                
                if (response.ok) {
                    const result = await response.json();
                    if (result.success) {
                        console.log('‚úÖ Order status updated in Google Sheets');
                    }
                }
                
            } catch (error) {
                console.error('Error updating order status in sheet:', error);
                // No mostrar error al usuario, es una actualizaci√≥n en segundo plano
            }
        }

        function updateOrdersList() {
            const container = document.getElementById('ordersList');
            
            if (orders.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-4">No hay pedidos guardados</p>';
                return;
            }
            
            // Ordenar pedidos: pendientes primero, luego completados
            const sortedOrders = [...orders].sort((a, b) => {
                if (a.status === 'pending' && b.status === 'completed') return -1;
                if (a.status === 'completed' && b.status === 'pending') return 1;
                return new Date(b.datetime) - new Date(a.datetime); // M√°s recientes primero dentro del mismo estado
            });
            
            container.innerHTML = sortedOrders.slice(0, 10).map(order => {
                const date = new Date(order.datetime);
                const productsList = Object.entries(order.products || {})
                    .filter(([key, qty]) => qty > 0)
                    .map(([key, qty]) => `${qty}x ${order.productNames[key] || 'Producto'}`)
                    .join(', ');
                
                const isCompleted = order.status === 'completed';
                const borderColor = isCompleted ? 'border-green-200 bg-green-50' : 'border-gray-200';
                
                return `
                    <div class="border ${borderColor} rounded-lg p-4 slide-up">
                        <div class="flex justify-between items-start mb-2">
                            <div class="font-semibold text-gray-800">#${order.orderNumber}</div>
                            <div class="text-sm text-gray-500">${date.toLocaleDateString()} ${date.toLocaleTimeString()}</div>
                        </div>
                        <div class="text-gray-700 mb-1">üë§ ${order.customerName}</div>
                        <div class="text-sm text-gray-600 mb-2">üçï ${productsList}</div>
                        <div class="flex justify-between items-center">
                            <div class="font-semibold text-blue-600">üì¶ ${order.total} items</div>
                            <div class="flex gap-2 items-center">
                                ${!isCompleted ? `
                                    <button onclick="markOrderCompleted(${order.orderNumber})" 
                                            class="text-xs px-3 py-2 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white rounded-lg font-bold transition-all duration-200 transform hover:scale-105">
                                        ‚úÖ Completar
                                    </button>
                                ` : ''}
                                <button onclick="exportOrderToPDF(orders.find(o => o.orderNumber === ${order.orderNumber}))" 
                                        class="text-xs px-3 py-2 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white rounded-lg font-bold transition-all duration-200 transform hover:scale-105">
                                    üìÑ Exportar
                                </button>
                                <div class="text-xs px-2 py-1 rounded-full ${isCompleted ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'}">
                                    ${isCompleted ? '‚úÖ Completado' : '‚è≥ Pendiente'}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Form submission using GET
        document.getElementById('newOrderForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const customerName = document.getElementById('customerName').value.trim();
            if (!customerName) {
                showMessage('Por favor ingresa el nombre del cliente', 'error');
                return;
            }
            
            // Check if any products selected
            const hasProducts = Object.values(currentOrder.products || {}).some(qty => qty > 0);
            if (!hasProducts) {
                showMessage('Por favor selecciona al menos un producto', 'error');
                return;
            }
            
            // Create order
            const order = {
                orderNumber: Date.now(),
                customerName: customerName,
                datetime: new Date().toISOString(),
                products: currentOrder.products,
                productNames: currentOrder.productNames,
                total: currentOrder.total,
                status: 'pending'
            };
            
            console.log('Creating order:', order);
            
            // Save locally
            orders.unshift(order);
            saveOrders();
            updateOrdersList();
            
            // Save to Google Sheets
            await saveOrderToSheet(order);
            
            closeNewOrderForm();
            showMessage(`‚úÖ Pedido #${order.orderNumber} guardado correctamente`, 'success');
        });

        async function saveOrderToSheet(order) {
            if (!scriptUrl) {
                showMessage('‚ö†Ô∏è No hay conexi√≥n configurada. Pedido guardado solo localmente.', 'warning');
                return;
            }
            
            try {
                console.log('=== GUARDANDO PEDIDO REAL CON GET ===');
                console.log('URL:', scriptUrl);
                console.log('Pedido:', JSON.stringify(order, null, 2));
                
                // Convertir el pedido a par√°metros GET
                const params = new URLSearchParams({
                    action: 'saveOrder',
                    orderNumber: order.orderNumber,
                    customerName: order.customerName,
                    datetime: order.datetime,
                    products: JSON.stringify(order.products),
                    productNames: JSON.stringify(order.productNames),
                    total: order.total,
                    status: order.status,
                    timestamp: Date.now()
                });
                
                const saveUrl = `${scriptUrl}?${params.toString()}`;
                console.log('URL de guardado:', saveUrl);
                
                const response = await fetch(saveUrl, {
                    method: 'GET',
                    mode: 'cors'
                });
                
                console.log('Response status:', response.status);
                console.log('Response ok:', response.ok);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                console.log('Response data:', JSON.stringify(result, null, 2));
                
                if (result.success) {
                    console.log('‚úÖ Order saved to Google Sheets successfully');
                    showMessage('‚úÖ Pedido guardado en Google Sheets', 'success');
                } else {
                    console.error('‚ùå Failed to save to Google Sheets:', result.error);
                    showMessage(`‚ö†Ô∏è Error al guardar en Google Sheets: ${result.error}`, 'warning');
                }
                
            } catch (error) {
                console.error('Error saving to sheet:', error);
                showMessage(`‚ö†Ô∏è Error de conexi√≥n: ${error.message}. Pedido guardado localmente.`, 'warning');
            }
        }

        // Sync function using GET
        async function syncData() {
            if (!scriptUrl) {
                showMessage('Primero configura la URL del script', 'error');
                return;
            }
            
            if (orders.length === 0) {
                showMessage('No hay pedidos para sincronizar', 'info');
                return;
            }
            
            try {
                showMessage('üîÑ Sincronizando datos...', 'info');
                
                const params = new URLSearchParams({
                    action: 'syncData',
                    orders: JSON.stringify(orders),
                    timestamp: Date.now()
                });
                
                const syncUrl = `${scriptUrl}?${params.toString()}`;
                
                const response = await fetch(syncUrl, {
                    method: 'GET',
                    mode: 'cors'
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                
                if (result.success) {
                    showMessage(`‚úÖ Sincronizaci√≥n exitosa. ${result.ordersReceived || orders.length} pedidos procesados.`, 'success');
                } else {
                    showMessage(`‚ùå Error al sincronizar: ${result.error}`, 'error');
                }
                
            } catch (error) {
                console.error('Sync error:', error);
                showMessage(`‚ùå Error al sincronizar: ${error.message}`, 'error');
            }
        }

        // Clear functions
        function clearAll() {
            confirmCount = 0;
            document.getElementById('confirmButton').textContent = 'Confirmar (0/3)';
            document.getElementById('confirmText').classList.add('hidden');
            document.getElementById('finalClearButton').classList.add('hidden');
            document.getElementById('clearModal').classList.remove('hidden');
            document.getElementById('clearModal').classList.add('flex');
        }

        function confirmClear() {
            confirmCount++;
            document.getElementById('confirmButton').textContent = `Confirmar (${confirmCount}/3)`;
            
            if (confirmCount >= 3) {
                document.getElementById('confirmText').classList.remove('hidden');
                document.getElementById('confirmButton').disabled = true;
                document.getElementById('confirmButton').classList.add('opacity-50');
                
                document.getElementById('confirmText').addEventListener('input', function(e) {
                    if (e.target.value === 'CONFIRMAR') {
                        document.getElementById('finalClearButton').classList.remove('hidden');
                    } else {
                        document.getElementById('finalClearButton').classList.add('hidden');
                    }
                });
            }
        }

        function performClear() {
            localStorage.clear();
            orders = [];
            products = {
                pizza_margarita: { name: 'Pizza Margarita', price: 0 },
                pizza_pepperoni: { name: 'Pizza Pepperoni', price: 0 },
                pizza_hawaiana: { name: 'Pizza Hawaiana', price: 0 },
                bebida_cola: { name: 'Coca Cola', price: 0 },
                bebida_agua: { name: 'Agua', price: 0 },
                postre_helado: { name: 'Helado', price: 0 }
            };
            scriptUrl = '';
            
            document.getElementById('scriptUrl').value = '';
            updateConnectionStatus('disconnected');
            updateOrdersList();
            createProductsSection();
            closeClearModal();
            
            showMessage('üóëÔ∏è Todos los datos han sido eliminados', 'success');
        }

        function closeClearModal() {
            document.getElementById('clearModal').classList.add('hidden');
            document.getElementById('clearModal').classList.remove('flex');
        }

        // Message system
        function showMessage(message, type = 'info') {
            const colors = {
                success: 'bg-green-100 text-green-800 border-green-200',
                error: 'bg-red-100 text-red-800 border-red-200',
                warning: 'bg-yellow-100 text-yellow-800 border-yellow-200',
                info: 'bg-blue-100 text-blue-800 border-blue-200'
            };
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `fixed top-4 left-4 right-4 p-4 rounded-lg border-2 ${colors[type]} z-50 fade-in`;
            messageDiv.textContent = message;
            
            document.body.appendChild(messageDiv);
            
            setTimeout(() => {
                messageDiv.remove();
            }, 5000);
            
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
    </script>
</body>
</html>
